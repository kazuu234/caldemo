# é–‹ç™ºå¼•ãç¶™ãŽãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€æ¬¡ã®AI AgentãŒé–‹ç™ºã‚’ç¶™ç¶šã™ã‚‹ãŸã‚ã®è©³ç´°ãªæƒ…å ±ã‚’è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚

**ä½œæˆæ—¥**: 2024å¹´12æœˆ  
**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: æµ·å¤–æ—…è¡Œã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚¢ãƒ—ãƒªï¼ˆCalendar Appï¼‰  
**ãƒªãƒã‚¸ãƒˆãƒª**: https://github.com/kazuu234/caldemo

---

## ðŸ“‹ ç›®æ¬¡

1. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦](#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦)
2. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
3. [ãƒ–ãƒ©ãƒ³ãƒæ§‹æˆã¨é–‹ç™ºå†…å®¹](#ãƒ–ãƒ©ãƒ³ãƒæ§‹æˆã¨é–‹ç™ºå†…å®¹)
4. [ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…è©³ç´°](#ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…è©³ç´°)
5. [ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…è©³ç´°](#ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…è©³ç´°)
6. [APIä»•æ§˜](#apiä»•æ§˜)
7. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ )
8. [ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š](#ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š)
9. [ãƒ†ã‚¹ãƒˆ](#ãƒ†ã‚¹ãƒˆ)
10. [æ—¢çŸ¥ã®å•é¡Œã¨æ³¨æ„äº‹é …](#æ—¢çŸ¥ã®å•é¡Œã¨æ³¨æ„äº‹é …)
11. [æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—](#æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—)

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç›®çš„
æµ·å¤–æ—…è¡Œã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚¢ãƒ—ãƒªã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ—…è¡Œäºˆå®šã‚’å…±æœ‰ã—ã€ç¾åœ°ã§åˆæµã§ãã‚‹æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

### ä¸»ãªæ©Ÿèƒ½
- **æ—…è¡Œäºˆå®šç®¡ç†**: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼/ãƒªã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼ã§äºˆå®šã‚’è¡¨ç¤ºãƒ»ç®¡ç†
- **åˆæµå‹Ÿé›†**: æ—…è¡Œå…ˆã§åˆæµã§ãã‚‹ä»²é–“ã‚’å‹Ÿé›†
- **ã‚ªãƒ•ä¼šç®¡ç†**: æ—¥æœ¬å›½å†…ãƒ»æµ·å¤–ã§ã®ã‚ªãƒ•ä¼šé–‹å‚¬ã€æ—¥ç¨‹å€™è£œæŠ•ç¥¨
- **é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ **: HTML5é€šçŸ¥API + Badging API
- **Discordé€£æº**: ï¼ˆå°†æ¥çš„ã«å®Ÿè£…äºˆå®šï¼‰

### é–‹ç™ºçµŒç·¯
- å…ƒã€…ã¯Figma Makeã§ç”Ÿæˆã•ã‚ŒãŸãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰
- localStorageã§ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã—ã¦ã„ãŸãŒã€Django REST Frameworkãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«ç§»è¡Œä¸­
- Netlifyã§ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯VPS + Dockerã§ãƒ‡ãƒ—ãƒ­ã‚¤äºˆå®š

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: React 18+ with TypeScript
- **ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«**: Vite
- **UIãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: 
  - Tailwind CSS
  - shadcn/uiï¼ˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰
- **ä¸»è¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**:
  - `react-router-dom` v6ï¼ˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰
  - `lucide-react`ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ï¼‰
  - `date-fns`ï¼ˆæ—¥ä»˜å‡¦ç†ï¼‰
  - `sonner`ï¼ˆToasté€šçŸ¥ï¼‰
- **ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°**: Netlify

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Django 5.0+ with Django REST Framework 3.15+
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: 
  - é–‹ç™º: SQLite
  - æœ¬ç•ª: PostgreSQLï¼ˆç§»è¡Œäºˆå®šï¼‰
- **ASGIã‚µãƒ¼ãƒãƒ¼**: Uvicorn
- **WSGIã‚µãƒ¼ãƒãƒ¼**: Gunicornï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- **CORS**: django-cors-headers
- **ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°**: VPS + Dockerï¼ˆäºˆå®šï¼‰

### é–‹ç™ºãƒ„ãƒ¼ãƒ«
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: Git
- **APIãƒ†ã‚¹ãƒˆ**: 
  - Postmanï¼ˆã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚ã‚Šï¼‰
  - pytestï¼ˆçµ±åˆãƒ†ã‚¹ãƒˆï¼‰

---

## ãƒ–ãƒ©ãƒ³ãƒæ§‹æˆã¨é–‹ç™ºå†…å®¹

### ãƒ–ãƒ©ãƒ³ãƒæ§‹é€ å›³

```
main
â”œâ”€â”€ drf-persistence           # Django REST Framework ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…
â”‚   â””â”€â”€ (ãƒ¦ãƒ¼ã‚¶ãƒ¼/åœ°ç†ãƒžã‚¹ã‚¿è¿½åŠ )
â”‚
â”œâ”€â”€ fe-api-integration        # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰APIçµ±åˆ
â”‚   â”œâ”€â”€ docker-deploy         # Dockerç’°å¢ƒæ§‹ç¯‰
â”‚   â””â”€â”€ api-tests             # APIãƒ†ã‚¹ãƒˆï¼ˆPostman/pytestï¼‰
â”‚
â””â”€â”€ (ãã®ä»–ã®ãƒ–ãƒ©ãƒ³ãƒ)
```

è©³ç´°ã¯ [`BRANCHES.md`](./BRANCHES.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…è©³ç´°

### ãƒ–ãƒ©ãƒ³ãƒ: `drf-persistence`

#### å®Ÿè£…å†…å®¹

**1. Django REST Framework ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ :
  ```
  backend/
  â”œâ”€â”€ manage.py
  â”œâ”€â”€ requirements.txt
  â”œâ”€â”€ server/
  â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”œâ”€â”€ settings.py
  â”‚   â”œâ”€â”€ urls.py
  â”‚   â”œâ”€â”€ wsgi.py
  â”‚   â””â”€â”€ asgi.py
  â””â”€â”€ api/
      â”œâ”€â”€ __init__.py
      â”œâ”€â”€ models.py
      â”œâ”€â”€ serializers.py
      â”œâ”€â”€ views.py
      â”œâ”€â”€ urls.py
      â”œâ”€â”€ admin.py
      â””â”€â”€ migrations/
  ```

**2. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ï¼ˆ`api/models.py`ï¼‰**

- **Trip**: æ—…è¡Œäºˆå®šãƒ»ã‚ªãƒ•ä¼š
  - `type`: 'trip' | 'meetup'
  - `user_discord_id`, `user_name`, `user_avatar`
  - `country`, `city`
  - `start_date`, `end_date`
  - `description`
  - `is_recruitment`: å‹Ÿé›†ãƒ•ãƒ©ã‚°
  - `recruitment_details`: å‹Ÿé›†è©³ç´°
  - `min_participants`, `max_participants`
  - `participants`: ManyToManyField to UserProfile
  - `is_hidden`: éžè¡¨ç¤ºãƒ•ãƒ©ã‚°
  - `candidate_dates`: JSONFieldï¼ˆæ—¥ç¨‹å€™è£œï¼‰
  - `date_votes`: JSONFieldï¼ˆæŠ•ç¥¨ï¼‰

- **Notification**: é€šçŸ¥
  - `user_discord_id`
  - `trip`: ForeignKey to Trip
  - `type`: 'recruitment' | 'day_before' | 'same_day' | 'comment' | 'other'
  - `title`, `message`
  - `read_at`: æ—¢èª­æ—¥æ™‚

- **Comment**: ã‚³ãƒ¡ãƒ³ãƒˆ
  - `trip`: ForeignKey to Trip
  - `user_discord_id`, `user_name`
  - `content`
  - `created_at`, `updated_at`

- **DateProposal**: æ—¥ç¨‹å€™è£œ
  - `trip`: ForeignKey to Trip
  - `date`: Date
  - `created_by_discord_id`

- **DateVote**: æ—¥ç¨‹æŠ•ç¥¨
  - `proposal`: ForeignKey to DateProposal
  - `user_discord_id`
  - unique_together: (proposal, user_discord_id)

- **Region**: åœ°åŸŸãƒžã‚¹ã‚¿
  - `code`: åœ°åŸŸã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹: 'ASIA', 'EUROPE'ï¼‰
  - `name`: åœ°åŸŸåï¼ˆä¾‹: 'ã‚¢ã‚¸ã‚¢', 'ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘'ï¼‰

- **Country**: å›½ãƒžã‚¹ã‚¿
  - `region`: ForeignKey to Region
  - `name`: å›½å
  - `code`: å›½ã‚³ãƒ¼ãƒ‰ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  - `emoji`: çµµæ–‡å­—ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

- **City**: éƒ½å¸‚ãƒžã‚¹ã‚¿
  - `country`: ForeignKey to Country
  - `name`: éƒ½å¸‚å

- **UserProfile**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒžã‚¹ã‚¿
  - `discord_id`: ä¸€æ„ã‚­ãƒ¼
  - `username`, `display_name`
  - `discriminator`, `avatar`
  - `is_active`
  - `created_at`, `updated_at`

**3. APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆ`api/views.py`ï¼‰**

- **TripsAPI** (`/api/trips/`)
  - `GET /api/trips/`: ä¸€è¦§å–å¾—ï¼ˆãƒ•ã‚£ãƒ«ã‚¿å¯¾å¿œï¼‰
  - `GET /api/trips/{id}/`: è©³ç´°å–å¾—
  - `POST /api/trips/`: ä½œæˆ
  - `PATCH /api/trips/{id}/`: æ›´æ–°
  - `DELETE /api/trips/{id}/`: å‰Šé™¤
  - `POST /api/trips/{id}/join/`: å‚åŠ 
  - `POST /api/trips/{id}/leave/`: é€€å‡º
  - `POST /api/trips/{id}/toggle_recruitment/`: å‹Ÿé›†ON/OFF
  - `POST /api/trips/{id}/end_recruitment/`: å‹Ÿé›†çµ‚äº†
  - `POST /api/trips/{id}/toggle_hidden/`: éžè¡¨ç¤ºON/OFF

- **NotificationsAPI** (`/api/notifications/`)
  - `GET /api/notifications/`: ä¸€è¦§å–å¾—
  - `GET /api/notifications/count`: æœªèª­æ•°å–å¾—
  - `POST /api/notifications/{id}/mark_read/`: æ—¢èª­åŒ–
  - `POST /api/notifications/mark_all_read/`: å…¨æ—¢èª­åŒ–

- **CommentsAPI** (`/api/comments/`)
  - `GET /api/comments/`: ä¸€è¦§å–å¾—ï¼ˆtripãƒ•ã‚£ãƒ«ã‚¿ï¼‰
  - `POST /api/comments/`: ä½œæˆ
  - `PATCH /api/comments/{id}/`: æ›´æ–°
  - `DELETE /api/comments/{id}/`: å‰Šé™¤

- **DateProposalsAPI** (`/api/date_proposals/`)
  - `GET /api/date_proposals/`: ä¸€è¦§å–å¾—ï¼ˆtripãƒ•ã‚£ãƒ«ã‚¿ï¼‰
  - `POST /api/date_proposals/`: ä½œæˆ
  - `DELETE /api/date_proposals/{id}/`: å‰Šé™¤
  - `GET /api/date_proposals/{id}/votes/`: æŠ•ç¥¨ä¸€è¦§
  - `POST /api/date_proposals/{id}/vote/`: æŠ•ç¥¨
  - `POST /api/date_proposals/{id}/unvote/`: æŠ•ç¥¨å–æ¶ˆ

- **UsersAPI** (`/api/users/`)
  - `GET /api/users/`: ä¸€è¦§å–å¾—ï¼ˆæ¤œç´¢å¯¾å¿œï¼‰
  - `GET /api/users/{id}/`: è©³ç´°å–å¾—

- **GeoAPI** (`/api/regions/`, `/api/countries/`, `/api/cities/`)
  - `GET /api/regions/`: åœ°åŸŸä¸€è¦§
  - `GET /api/countries/`: å›½ä¸€è¦§ï¼ˆregionãƒ•ã‚£ãƒ«ã‚¿å¯¾å¿œï¼‰
  - `GET /api/cities/`: éƒ½å¸‚ä¸€è¦§ï¼ˆcountry/regionãƒ•ã‚£ãƒ«ã‚¿å¯¾å¿œï¼‰

**4. Djangoç®¡ç†ã‚³ãƒžãƒ³ãƒ‰**

- **`load_geo_seed`**: åœ°ç†ãƒžã‚¹ã‚¿ã®ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
  ```bash
  python manage.py load_geo_seed [--clean]
  ```
  - `src/components/countries-data.ts` ã¨ `src/components/japan-cities-data.ts` ã‚’ãƒ‘ãƒ¼ã‚¹
  - `--clean`: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ã‹ã‚‰æŠ•å…¥

- **`load_users_seed`**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒžã‚¹ã‚¿ã®ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
  ```bash
  python manage.py load_users_seed [--clean]
  ```
  - `src/utils/auth.ts` ã® `USERS_MASTER` ã‚’ãƒ‘ãƒ¼ã‚¹
  - `--clean`: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ã‹ã‚‰æŠ•å…¥

- **`load_trips_seed`**: æ—…è¡Œäºˆå®šã®ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
  ```bash
  python manage.py load_trips_seed [--clean] [--source json|app]
  ```
  - `--source json`: `backend/seed/trips.json` ã‹ã‚‰èª­ã¿è¾¼ã¿
  - `--source app`: `src/App.tsx` ã® `initialTrips` ã‚’ãƒ‘ãƒ¼ã‚¹
  - `--clean`: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ã‹ã‚‰æŠ•å…¥

**5. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**

- **`backend/requirements.txt`**:
  ```
  Django>=5.0,<6.0
  djangorestframework>=3.15,<4.0
  django-cors-headers>=4.3,<5.0
  psycopg[binary]>=3.2,<4.0
  python-dotenv>=1.0,<2.0
  gunicorn
  uvicorn
  ```

- **`backend/server/settings.py`**:
  - SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®šï¼ˆé–‹ç™ºç”¨ï¼‰
  - CORSè¨­å®šï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ‰ãƒ¡ã‚¤ãƒ³è¨±å¯ï¼‰
  - REST Frameworkè¨­å®š

---

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…è©³ç´°

### ãƒ–ãƒ©ãƒ³ãƒ: `fe-api-integration`

#### å®Ÿè£…å†…å®¹

**1. APIçµ±åˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ`src/utils/api.ts`ï¼‰**

- **API_BASE_URL**: ç’°å¢ƒå¤‰æ•° `VITE_API_BASE_URL` ã‹ã‚‰å–å¾—ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `http://localhost:8000/api`ï¼‰
- **requesté–¢æ•°**: å…±é€šã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†
- **APIãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**:
  - `TripsAPI`: æ—…è¡Œäºˆå®šã®CRUD + ã‚«ã‚¹ã‚¿ãƒ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  - `NotificationsAPI`: é€šçŸ¥ã®å–å¾—ãƒ»æ—¢èª­åŒ–
  - `CommentsAPI`: ã‚³ãƒ¡ãƒ³ãƒˆã®CRUD
  - `DateProposalsAPI`: æ—¥ç¨‹å€™è£œãƒ»æŠ•ç¥¨ã®ç®¡ç†
  - `UsersAPI`: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—
  - `GeoAPI`: åœ°åŸŸãƒ»å›½ãƒ»éƒ½å¸‚ã®å–å¾—

**2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆ`src/utils/users.ts`ï¼‰**

- `usersCache`: Mapã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- `initUsers()`: å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—ã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
- `getUserByDiscordId()`: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—

**3. åœ°ç†ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒƒã‚¯ï¼ˆ`src/hooks/useGeoData.ts`ï¼‰**

- `useGeoData()`: åœ°åŸŸãƒ»å›½ãƒ»éƒ½å¸‚ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
- è¿”ã‚Šå€¤:
  - `regions`: åœ°åŸŸåã®é…åˆ—
  - `countriesByRegion`: åœ°åŸŸåˆ¥ã®å›½ãƒžãƒƒãƒ—
  - `countriesCities`: å›½åˆ¥ã®éƒ½å¸‚ãƒžãƒƒãƒ—

**4. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå¤‰æ›´**

- **`App.tsx`**:
  - `trips` ã‚¹ãƒ†ãƒ¼ãƒˆã‚’APIã‹ã‚‰å–å¾—ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´
  - `handleAddTrip`, `handleSaveTrip`, `handleDeleteTrip` ãªã©ã‚’APIå‘¼ã³å‡ºã—ã«å¤‰æ›´
  - `useEffect` ã§èªè¨¼æ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’åˆæœŸåŒ–
  - `useGeoData` ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨

- **`CountryFilter.tsx`**:
  - é™çš„ãƒ‡ãƒ¼ã‚¿ï¼ˆ`COUNTRIES_CITIES`, `REGIONS`ï¼‰ã‹ã‚‰ `useGeoData` ãƒ•ãƒƒã‚¯ã«å¤‰æ›´

- **`AddTripPage.tsx`**, **`AddMeetupPage.tsx`**, **`CreateRecruitmentDialog.tsx`**:
  - å›½ãƒ»éƒ½å¸‚é¸æŠžã‚’ `useGeoData` ãƒ•ãƒƒã‚¯ã«å¤‰æ›´

- **`MeetupsView.tsx`**:
  - `CommentsPanel` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’çµ±åˆ
  - `getUserByDiscordId` ã‚’ `utils/users` ã‹ã‚‰å–å¾—

- **`CommentsPanel.tsx`**ï¼ˆæ–°è¦ï¼‰:
  - ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤ºãƒ»æŠ•ç¨¿ãƒ»å‰Šé™¤æ©Ÿèƒ½
  - `CommentsAPI` ã‚’ä½¿ç”¨

**5. é€šçŸ¥æ©Ÿèƒ½ï¼ˆ`src/utils/notifications.ts`ï¼‰**

- `getUnreadCount()`, `setUnreadCount()` ãªã©ã‚’APIå‘¼ã³å‡ºã—ã«å¤‰æ›´
- `NotificationsAPI.getUnreadCount()` ã‚’ä½¿ç”¨
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦localStorageã‚‚ä½¿ç”¨

---

## APIä»•æ§˜

### ãƒ™ãƒ¼ã‚¹URL
- é–‹ç™º: `http://localhost:8000/api`
- æœ¬ç•ª: ç’°å¢ƒå¤‰æ•° `VITE_API_BASE_URL` ã§è¨­å®š

### èªè¨¼
- **ç¾çŠ¶**: æœªå®Ÿè£…ï¼ˆå°†æ¥çš„ã«Discordèªè¨¼ã‚’å®Ÿè£…äºˆå®šï¼‰
- **ç¾åœ¨**: `user_discord_id` ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã§é€ä¿¡

### ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹
```json
{
  "detail": "ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"
}
```

### ä¸»è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

è©³ç´°ã¯ [`src/BACKEND_SPEC.md`](./src/BACKEND_SPEC.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ 

### ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

- `0001_initial.py`: Tripãƒ¢ãƒ‡ãƒ«
- `0002_notifications_comments_votes.py`: Notification, Comment, DateProposal, DateVote
- `0003_geo_models.py`: Region, Country, City
- `0004_userprofile.py`: UserProfile

### ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

```bash
cd backend
python manage.py migrate
```

### ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿æŠ•å…¥

```bash
# åœ°ç†ãƒžã‚¹ã‚¿
python manage.py load_geo_seed --clean

# ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒžã‚¹ã‚¿
python manage.py load_users_seed --clean

# æ—…è¡Œäºˆå®šï¼ˆApp.tsxã‹ã‚‰ï¼‰
python manage.py load_trips_seed --clean --source app
```

---

## ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š

### ãƒ–ãƒ©ãƒ³ãƒ: `docker-deploy`

#### å®Ÿè£…å†…å®¹

**1. Dockerè¨­å®š**

- **`docker/backend.Dockerfile`**:
  - ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸: `python:3.11-slim`
  - Uvicornã§ASGIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•
  - ãƒãƒ¼ãƒˆ: 8000

- **`docker/docker-compose.yml`**:
  - **db**: PostgreSQL 15
  - **backend**: Djangoã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
  - **caddy**: ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ï¼ˆTLSçµ‚ç«¯ï¼‰

- **`docker/Caddyfile`**:
  - ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®š
  - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¸ã®ãƒ—ãƒ­ã‚­ã‚·è¨­å®š

**2. ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ï¼ˆ`DEPLOY_DOCKER.md`ï¼‰**

1. VPSç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
2. Docker/Docker Composeã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
3. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³
4. `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
5. `docker-compose up -d` ã§èµ·å‹•
6. ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
7. ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿æŠ•å…¥

è©³ç´°ã¯ `docker-deploy` ãƒ–ãƒ©ãƒ³ãƒã® `DEPLOY_DOCKER.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## ãƒ†ã‚¹ãƒˆ

### ãƒ–ãƒ©ãƒ³ãƒ: `api-tests`

#### å®Ÿè£…å†…å®¹

**1. Postmanã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆ`tests/postman_collection.json`ï¼‰**

- å…¨APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹
- ç’°å¢ƒå¤‰æ•°: `base_url`, `trip_id`, `user_id` ãªã©

**2. pytestçµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ`tests/test_api_integration.py`ï¼‰**

- ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹:
  - `TestGeoAPI`: åœ°ç†ãƒ‡ãƒ¼ã‚¿API
  - `TestUsersAPI`: ãƒ¦ãƒ¼ã‚¶ãƒ¼API
  - `TestTripsAPI`: æ—…è¡Œäºˆå®šAPI
  - `TestNotificationsAPI`: é€šçŸ¥API
  - `TestCommentsAPI`: ã‚³ãƒ¡ãƒ³ãƒˆAPI
  - `TestDateProposalsAPI`: æ—¥ç¨‹å€™è£œãƒ»æŠ•ç¥¨API

**3. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**

```bash
cd backend
pip install pytest requests
pytest ../tests/test_api_integration.py -v
```

è©³ç´°ã¯ `tests/README.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## æ—¢çŸ¥ã®å•é¡Œã¨æ³¨æ„äº‹é …

### 1. èªè¨¼æœªå®Ÿè£…
- ç¾åœ¨ã¯èªè¨¼æ©Ÿèƒ½ãŒæœªå®Ÿè£…
- `user_discord_id` ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã§é€ä¿¡ã—ã¦ã„ã‚‹ãŒã€å°†æ¥çš„ã«Discordèªè¨¼ã‚’å®Ÿè£…äºˆå®š
- èªè¨¼å®Ÿè£…æ™‚ã¯ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã‚„JWTãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨ŽãŒå¿…è¦

### 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- é–‹ç™ºç’°å¢ƒã¯SQLiteã‚’ä½¿ç”¨
- æœ¬ç•ªç’°å¢ƒã§ã¯PostgreSQLã«ç§»è¡Œäºˆå®š
- ç§»è¡Œæ™‚ã¯ `settings.py` ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®šã‚’å¤‰æ›´

### 3. CORSè¨­å®š
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ `CORS_ALLOWED_ORIGINS` ã«è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- æœ¬ç•ªç’°å¢ƒã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¨­å®šã™ã‚‹ã“ã¨

### 4. æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆ
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: `Date` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ â†’ ISOæ–‡å­—åˆ—
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: ISOæ–‡å­—åˆ— â†’ `date` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®æ‰±ã„ã«æ³¨æ„

### 5. çµµæ–‡å­—ãƒ»åœ°åŸŸã‚³ãƒ¼ãƒ‰
- `Country.code` ãŒç©ºã®å¯èƒ½æ€§ãŒã‚ã‚‹
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§çµµæ–‡å­—ã‚’æœŸå¾…ã—ã¦ã„ã‚‹å ´åˆã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ä¿å­˜ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

### 6. å‚åŠ è€…é…åˆ—
- `participants` ã¯ `string[]` (discord_id) ã¨ã—ã¦æ‰±ã†
- join/leave ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯ãŒå¿…è¦

### 7. é€šçŸ¥ã®æ—¢èª­åæ˜ 
- `mark_read` / `mark_all_read` ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°
- `read_at` ãŒæ­£ã—ãè¨­å®šã•ã‚Œã‚‹ã‹ç¢ºèª

### 8. å‹•ä½œç¢ºèªæœªå®Œäº†
- å¤§é‡ã®ã‚³ãƒ¼ãƒ‰ä¿®æ­£ã‚’è¡Œã£ãŸãŒã€å‹•ä½œç¢ºèªãŒä¸ååˆ†
- å„æ©Ÿèƒ½ã®å‹•ä½œç¢ºèªãŒå¿…è¦

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### å„ªå…ˆåº¦: é«˜

1. **å‹•ä½œç¢ºèªã¨ãƒ‡ãƒãƒƒã‚°**
   - ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’èµ·å‹•
   - å„æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª
   - ã‚¨ãƒ©ãƒ¼ã®ä¿®æ­£

2. **èªè¨¼æ©Ÿèƒ½ã®å®Ÿè£…**
   - Discordèªè¨¼ã®å®Ÿè£…
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã¾ãŸã¯JWTãƒˆãƒ¼ã‚¯ãƒ³ã®å®Ÿè£…

3. **PostgreSQLã¸ã®ç§»è¡Œ**
   - æœ¬ç•ªç’°å¢ƒç”¨ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
   - ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¢ºèª

### å„ªå…ˆåº¦: ä¸­

4. **æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤**
   - VPSç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
   - Docker Composeã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤
   - ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®š

5. **ãƒ†ã‚¹ãƒˆã®æ‹¡å……**
   - å˜ä½“ãƒ†ã‚¹ãƒˆã®è¿½åŠ 
   - çµ±åˆãƒ†ã‚¹ãƒˆã®æ‹¡å……

6. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æœ€é©åŒ–**
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã®æœ€é©åŒ–
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å®Ÿè£…

### å„ªå…ˆåº¦: ä½Ž

7. **æ©Ÿèƒ½è¿½åŠ **
   - Discordé€£æºã®å®Ÿè£…
   - ãã®ä»–ã®æ©Ÿèƒ½è¿½åŠ 

---

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆ`drf-persistence` ãƒ–ãƒ©ãƒ³ãƒï¼‰

```
backend/
â”œâ”€â”€ manage.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ README.md
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py
â”‚   â”œâ”€â”€ urls.py
â”‚   â”œâ”€â”€ wsgi.py
â”‚   â””â”€â”€ asgi.py
â””â”€â”€ api/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ models.py
    â”œâ”€â”€ serializers.py
    â”œâ”€â”€ views.py
    â”œâ”€â”€ urls.py
    â”œâ”€â”€ admin.py
    â”œâ”€â”€ migrations/
    â”‚   â”œâ”€â”€ 0001_initial.py
    â”‚   â”œâ”€â”€ 0002_notifications_comments_votes.py
    â”‚   â”œâ”€â”€ 0003_geo_models.py
    â”‚   â””â”€â”€ 0004_userprofile.py
    â””â”€â”€ management/
        â””â”€â”€ commands/
            â”œâ”€â”€ load_geo_seed.py
            â”œâ”€â”€ load_users_seed.py
            â””â”€â”€ load_trips_seed.py
```

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆ`fe-api-integration` ãƒ–ãƒ©ãƒ³ãƒï¼‰

```
src/
â”œâ”€â”€ App.tsx
â”œâ”€â”€ main.tsx
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ api.ts          # APIçµ±åˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ auth.ts         # èªè¨¼ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
â”‚   â”œâ”€â”€ notifications.ts # é€šçŸ¥æ©Ÿèƒ½
â”‚   â””â”€â”€ users.ts         # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useGeoData.ts   # åœ°ç†ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒƒã‚¯
â””â”€â”€ components/
    â”œâ”€â”€ CommentsPanel.tsx # ã‚³ãƒ¡ãƒ³ãƒˆãƒ‘ãƒãƒ«ï¼ˆæ–°è¦ï¼‰
    â”œâ”€â”€ CountryFilter.tsx
    â”œâ”€â”€ AddTripPage.tsx
    â”œâ”€â”€ AddMeetupPage.tsx
    â”œâ”€â”€ CreateRecruitmentDialog.tsx
    â”œâ”€â”€ MeetupsView.tsx
    â””â”€â”€ ...
```

### Dockerè¨­å®šï¼ˆ`docker-deploy` ãƒ–ãƒ©ãƒ³ãƒï¼‰

```
docker/
â”œâ”€â”€ backend.Dockerfile
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ Caddyfile
```

### ãƒ†ã‚¹ãƒˆï¼ˆ`api-tests` ãƒ–ãƒ©ãƒ³ãƒï¼‰

```
tests/
â”œâ”€â”€ postman_collection.json
â”œâ”€â”€ test_api_integration.py
â””â”€â”€ README.md
```

---

## ç’°å¢ƒå¤‰æ•°

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

- `VITE_API_BASE_URL`: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã®ãƒ™ãƒ¼ã‚¹URLï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `http://localhost:8000/api`ï¼‰

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

- `DATABASE_URL`: PostgreSQLæŽ¥ç¶šURLï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰
- `SECRET_KEY`: Djangoã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼
- `ALLOWED_HOSTS`: è¨±å¯ã™ã‚‹ãƒ›ã‚¹ãƒˆ
- `CORS_ALLOWED_ORIGINS`: CORSè¨±å¯ã‚ªãƒªã‚¸ãƒ³

---

## é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

```bash
cd backend
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -r requirements.txt
python manage.py migrate
python manage.py load_geo_seed --clean
python manage.py load_users_seed --clean
python manage.py load_trips_seed --clean --source app
python manage.py runserver 0.0.0.0:8000
```

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

```bash
npm install
VITE_API_BASE_URL=http://localhost:8000/api npm run dev
```

---

## ã‚³ãƒŸãƒƒãƒˆå±¥æ­´ã®ç¢ºèª

å„ãƒ–ãƒ©ãƒ³ãƒã®ä¸»è¦ãªã‚³ãƒŸãƒƒãƒˆ:

- **drf-persistence**:
  - `6364ed0`: Django DRFãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰åˆæœŸå®Ÿè£…
  - `b8c7d23`: åœ°ç†ãƒžã‚¹ã‚¿è¿½åŠ 
  - `5ff4bcd`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒžã‚¹ã‚¿è¿½åŠ 
  - `db6d313`: æ—…è¡Œäºˆå®šã‚·ãƒ¼ãƒ‰ã‚³ãƒžãƒ³ãƒ‰è¿½åŠ 

- **fe-api-integration**:
  - `e6e1b81`: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰APIçµ±åˆ
  - `034b1ae`: api.tsã®ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆè§£æ±º

- **docker-deploy**:
  - `36a7a35`: Dockerè¨­å®šè¿½åŠ 

- **api-tests**:
  - `96e48f0`: ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰è¿½åŠ 

---

## é€£çµ¡å…ˆãƒ»å‚è€ƒè³‡æ–™

- **ãƒªãƒã‚¸ãƒˆãƒª**: https://github.com/kazuu234/caldemo
- **ãƒ–ãƒ©ãƒ³ãƒæ§‹æˆ**: [`BRANCHES.md`](./BRANCHES.md)
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ä»•æ§˜**: [`src/BACKEND_SPEC.md`](./src/BACKEND_SPEC.md)
- **ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †**: `docker-deploy` ãƒ–ãƒ©ãƒ³ãƒã® `DEPLOY_DOCKER.md`

---

**ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ç¶™ç¶šçš„ã«æ›´æ–°ã—ã¦ãã ã•ã„ã€‚**

